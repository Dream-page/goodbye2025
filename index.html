<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ì–´ë“œë²¤íŠ¸ ìº˜ë¦°ë”</title>
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome ì•„ì´ì½˜ ë¡œë“œ --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts (Gaegu) --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    <!-- HTMLì„ ì´ë¯¸ì§€ë¡œ ë°”ê¾¸ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- ì—‘ì…€ íŒŒì¼(xlsx)ì„ ì½ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- (â˜…ì‹ ê·œâ˜…) Firebase SDK 11.6.1 ë¡œë“œ -->
    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel, doc, getDoc, setDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // (â˜… 2ë‹¨ê³„ â˜…) 
        // ì´ê³³ì— Google Firebase ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ
        // firebaseConfig ê°ì²´ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
        const firebaseConfig = {
          apiKey: "AIzaSyBo9J3psRdM1Fh6JW7G8UYcgJGxQXmv9dk",
  authDomain: "advent-calendar-1f508.firebaseapp.com",
  projectId: "advent-calendar-1f508",
  storageBucket: "advent-calendar-1f508.firebasestorage.app",
  messagingSenderId: "724448812706",
  appId: "1:724448812706:web:fedf4d00d9f147f3b8c1fb",
  measurementId: "G-6CDELFGGB3"
        };

        // --- (â˜…ì‹¤ì „ìš©â˜…) í•œêµ­ í‘œì¤€ì‹œ(KST) ê¸°ì¤€ í˜„ì¬ ë‚ ì§œ ì„¤ì • ---
        const KST_OFFSET = 9 * 60 * 60 * 1000; // 9ì‹œê°„(ms)
        const NOW = new Date();
        const UTC = NOW.getTime() + (NOW.getTimezoneOffset() * 60 * 1000);
        const TODAY = new Date(UTC + KST_OFFSET);
        // --- í…ŒìŠ¤íŠ¸ìš© ë‚ ì§œ (ì£¼ì„ ì²˜ë¦¬) ---
        // const DEMO_DATE = new Date('2025-12-24T00:00:00'); // 24ì¼ í…ŒìŠ¤íŠ¸ìš©
        // const TODAY = DEMO_DATE;
        
        const CURRENT_DAY = TODAY.getDate();
        const CURRENT_MONTH = TODAY.getMonth() + 1; // (0 = 1ì›”, 11 = 12ì›”)

        // --- ë°ì´í„°ë² ì´ìŠ¤ (ì§ˆë¬¸, ì¢Œí‘œ, ê´€ë¦¬ì ë¹„ë²ˆ ë“±) ---

        // 1. ê¸°ë³¸ í•™ìƒ ëª…ë‹¨ (DBì— ê°±ì‹ ëœ ëª…ë‹¨ì´ ì—†ì„ ê²½ìš° ì‚¬ìš©ë¨)
        const defaultStudentDB = [
          { id: 'student1', name: 'ê¹€ì² ìˆ˜', pass: '1234' },
          { id: 'student2', name: 'ì´ì˜í¬', pass: '5678' },
          { id: 'student3', name: 'ë°•ì§€ì„±', pass: '0000' },
          { id: 'student_test', name: 'í…ŒìŠ¤íŠ¸', pass: '1111' }
        ];

        // 2. 25ì¼ê°„ì˜ ì§ˆë¬¸ (â˜…ê³ ì •â˜…)
        const questionsDB = [
            "ì˜¬í•´ ê°€ì¥ í¬ê²Œ ì›ƒì—ˆë˜ ì¬ë¯¸ìˆëŠ” ì¼ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", // 1
            "ì˜¬í•´ ìƒˆë¡œ ì‚¬ê·„ ì¹œêµ¬ê°€ ìˆë‚˜ìš”? ê·¸ ì¹œêµ¬ì˜ ì¢‹ì€ ì ì€?", // 2
            "ì˜¬í•´ ë¨¹ì—ˆë˜ ìŒì‹ ì¤‘ì— 'ì§„ì§œ ìµœê³ !'ì˜€ë˜ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?", // 3
            "ì˜¬í•´ ë‚´ê°€ ë‚˜ ìì‹ ì—ê²Œ 'ì°¸ ì˜í–ˆë‹¤'ê³  ì¹­ì°¬í•´ì£¼ê³  ì‹¶ì€ ì¼ì€?", // 4
            "ì˜¬í•´ ë‚˜ì—ê²Œ ê°€ì¥ ê³ ë§ˆì› ë˜ ì‚¬ëŒì€ ëˆ„êµ¬ì¸ê°€ìš”?", // 5
            "ì˜¬í•´ í•™êµì—ì„œ ê°€ì¥ ì¬ë¯¸ìˆì—ˆë˜ ìˆ˜ì—…ì´ë‚˜ ë†€ì´ëŠ” ë­ì˜€ë‚˜ìš”?", // 6
            "ì˜¬í•´ ìƒˆë¡œ ë°°ìš´ ê²ƒ ì¤‘ì— ê°€ì¥ ì‹ ê¸°í•˜ê³  ì¬ë¯¸ìˆì—ˆë˜ ê²ƒì€?", // 7
            "ì˜¬í•´ ì¹œêµ¬ì™€ ê°€ì¥ ì‹ ë‚˜ê²Œ ë†€ì•˜ë˜ ê¸°ì–µì€? ", // 8
            "ì˜¬í•´ ë°›ì€(ë˜ëŠ” ì¤€) 'ì„ ë¬¼' ì¤‘ì— ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì€?", // 9
            "ì˜¬í•´ ë‚´ê°€ ê·¸ë¦° ê·¸ë¦¼ì´ë‚˜ ë§Œë“  ê²ƒ ì¤‘ì— ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ê²ƒì€?", // 10
            "ì˜¬í•´ ê°€ë´¤ë˜ ê³³ ì¤‘ì— ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¥ì†ŒëŠ” ì–´ë””ì¸ê°€ìš”?", // 11
            "ì˜¬í•´ ë‚˜ë¥¼ ê°€ì¥ í–‰ë³µí•˜ê²Œ í–ˆë˜ ë…¸ë˜(ë˜ëŠ” ì±…, ì˜í™”)ëŠ”?", // 12
            "ì˜¬í•´ ë‚´ê°€ 'ìš©ê¸°'ë¥¼ ëƒˆë˜ ë©‹ì§„ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?", // 13
            "ì˜¬í•´ê°€ ê°€ê¸° ì „ì— ê¼­ \"ê³ ë§ˆì›Œ!\" í•˜ê³  ë§í•˜ê³  ì‹¶ì€ ì‚¬ëŒì€?", // 14
            "ì˜¬í•´ ìš°ë¦¬ ë°˜ì—ì„œ ìˆì—ˆë˜ ì¼ ì¤‘ì— ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¼ì€?", // 15
            "ì˜¬í•´ ë‚´ê°€ 'ê¾¸ì¤€íˆ' ë…¸ë ¥í•´ì„œ ë¿Œë“¯í–ˆë˜ ì¼ì´ ìˆë‚˜ìš”?", // 16
            "ì˜¬í•´ ê°€ì¥ ì¬ë¯¸ìˆê²Œ ì½ì€ ì±…ì´ë‚˜ ë§Œí™”ì±…ì€ ë¬´ì—‡ì¸ê°€ìš”?", // 17
            "ì˜¬í•´ ê°€ì¥ ë§ˆìŒì´ í¸ì•ˆí•˜ê³  ë”°ëœ»í–ˆë˜ ì¥ì†ŒëŠ” ì–´ë””ì˜€ë‚˜ìš”?", // 18
            "1ë…„ ì „ì˜ ë‚˜ë³´ë‹¤ ì§€ê¸ˆì˜ ë‚´ê°€ ë” ì˜í•˜ê²Œ ëœ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?", // 19
            "ë‚´ë…„ì˜ ë‚˜ì—ê²Œ ê¼­ í•´ì£¼ê³  ì‹¶ì€ ì¡°ì–¸ í•œ ê°€ì§€ëŠ”?", // 20
            "ë‚´ë…„ì— ë‚´ê°€ ê¼­ í•´ë³´ê³  ì‹¶ì€ 'ìƒˆë¡œìš´' ì¼ í•œ ê°€ì§€ëŠ”?", // 21
            "ë‚´ë…„ì— ê¼­ ê°€ë³´ê³  ì‹¶ì€ ê³³ì´ ìˆë‚˜ìš”? (ìƒìƒì˜ ì¥ì†Œë„ ì¢‹ì•„ìš”!)", // 22
            "ì˜¬í•´ì˜ ë‚˜ë¥¼ í•œ ë‹¨ì–´ë¡œ í‘œí˜„í•œë‹¤ë©´ ë¬´ì—‡ì´ê³  ê·¸ ì´ìœ ëŠ”?", // 23
            "2025ë…„ í•œ í•´ë¥¼ ë³´ë‚¸ ë‚˜ ìì‹ ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ì¹­ì°¬ í•œë§ˆë””!", // 24
            "ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ğŸ„ 2025ë…„, ë‚´ë…„ì—ëŠ” ì–´ë–¤ ë©‹ì§„ ì¼ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì„ê¹Œìš”?" // 25
        ];

        // 3. (â˜…ê³ ì •â˜…) 1-25ë²ˆ ì‚¬ìš©ì ì§€ì • ì¢Œí‘œ
        const hotspotCoordinates = [
            { top: '76.0%', left: '15.8%', size: '7.5%' },  // 1
            { top: '81.5%', left: '27.0%', size: '7.5%' },  // 2
            { top: '83.5%', left: '40.3%', size: '7.5%' },  // 3
            { top: '83.5%', left: '51.8%', size: '7.5%' },  // 4
            { top: '82.5%', left: '62.3%', size: '7.5%' },  // 5
            { top: '78.5%', left: '74.3%', size: '7.5%' },  // 6
            { top: '67%', left: '23.3%', size: '8%' },     // 7
            { top: '70.5%', left: '33.8%', size: '8%' },     // 8
            { top: '72.5%', left: '45.3%', size: '8%' },   // 9
            { top: '72%', left: '55.9%', size: '8%' },     // 10
            { top: '70%', left: '67.3%', size: '8%' },     // 11
            { top: '53.5%', left: '25.8%', size: '8.5%' },  // 12
            { top: '58%', left: '37.3%', size: '8.5%' },   // 13
            { top: '59%', left: '46.8%', size: '8.5%' },   // 14
            { top: '58%', left: '57.3%', size: '8.5%' },   // 15
            { top: '56.5%', left: '67.3%', size: '8.5%' },  // 16
            { top: '46.5%', left: '33.3%', size: '8.5%' },  // 17
            { top: '46.5%', left: '47.3%', size: '8.5%' },  // 18
            { top: '46.5%', left: '61.3%', size: '8.5%' },  // 19
            { top: '37%', left: '40.0%', size: '9%' },     // 20
            { top: '37%', left: '54.3%', size: '9%' },     // 21
            { top: '23.5%', left: '40.0%', size: '9%' },   // 22
            { top: '23.5%', left: '54.3%', size: '9%' },   // 23
            { top: '14.5%', left: '47.3%', size: '9%' },    // 24
            { top: '0.5%', left: '45.3%', size: '13%' }    // 25 (ë³„)
        ];
        
        // --- ì „ì—­ ë³€ìˆ˜ ---
        let app, db, auth; // Firebase ì¸ìŠ¤í„´ìŠ¤
        let currentRoomId = null; // ì‚¬ìš©ìê°€ ì…ë ¥í•œ 'í•™ê¸‰/ë°© ê³ ìœ  ID'
        let studentDB = [];
        let currentStudentId = null;
        let currentStudentName = null;
        let userAnswers = {};
        let adminSelectedAnswers = {};
        let studentListUnsubscribe = null;
        let userAnswersUnsubscribe = null;
        let adminSelectedUnsubscribe = null;

        const ADMIN_PASS = "dream";
        let snowCreated = false;

        // --- DOM ìš”ì†Œ ì°¸ì¡° ---
        let roomIdPage, roomIdInput, roomIdSubmit, roomIdError, roomIdLoading;
        let loginPage, mainPage, notesPage, resultsPage;
        let nameInput, passInput, loginButton, loginError;
        let studentNameHeader, calendarContainer, goToNotes, logoutButton;
        let notesHeader, goToMain, notesContainer, downloadNotesButton;
        let modal, modalTitle, modalQuestion, modalTextarea, modalSave, modalClose;
        let adminSettingsButton, adminModal, adminModalClose, downloadExampleExcel, excelFileInput, uploadExcelButton, adminMessage, viewResultsButton;
        let backToLoginButton, studentListContainer, studentResultDetail, resultDetailName, downloadAdminResultButton;
        let adminPasswordModal, adminPasswordInput, adminPasswordSubmit, adminPasswordClose, adminPasswordError;
        let congratsModal, congratsModalClose, snowContainer;
        let loadingOverlay;

        // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ---
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            // --- DOM ìš”ì†Œ í• ë‹¹ ---
            roomIdPage = document.getElementById('room-id-page');
            roomIdInput = document.getElementById('room-id-input');
            roomIdSubmit = document.getElementById('room-id-submit');
            roomIdError = document.getElementById('room-id-error');
            roomIdLoading = document.getElementById('room-id-loading');
            
            loginPage = document.getElementById('login-page');
            mainPage = document.getElementById('main-page');
            notesPage = document.getElementById('notes-page');
            resultsPage = document.getElementById('results-page');
            
            nameInput = document.getElementById('name-input');
            passInput = document.getElementById('pass-input');
            loginButton = document.getElementById('login-button');
            loginError = document.getElementById('login-error');
            
            studentNameHeader = document.getElementById('student-name-header');
            calendarContainer = document.getElementById('calendar-image-container'); 
            goToNotes = document.getElementById('go-to-notes');
            logoutButton = document.getElementById('logout-button');

            notesHeader = document.getElementById('notes-header');
            goToMain = document.getElementById('go-to-main');
            notesContainer = document.getElementById('notes-container');
            downloadNotesButton = document.getElementById('download-notes-button'); 

            modal = document.getElementById('modal');
            modalTitle = document.getElementById('modal-title');
            modalQuestion = document.getElementById('modal-question');
            modalTextarea = document.getElementById('modal-textarea');
            modalSave = document.getElementById('modal-save');
            modalClose = document.getElementById('modal-close');
            
            adminSettingsButton = document.getElementById('admin-settings-button');
            adminModal = document.getElementById('admin-modal');
            adminModalClose = document.getElementById('admin-modal-close');
            downloadExampleExcel = document.getElementById('download-example-excel');
            excelFileInput = document.getElementById('excel-file-input');
            uploadExcelButton = document.getElementById('upload-excel-button');
            adminMessage = document.getElementById('admin-message');
            viewResultsButton = document.getElementById('view-results-button');
            
            backToLoginButton = document.getElementById('back-to-login-button');
            studentListContainer = document.getElementById('student-list-container');
            studentResultDetail = document.getElementById('student-result-detail');
            resultDetailName = document.getElementById('result-detail-name');
            downloadAdminResultButton = document.getElementById('download-admin-result-button');

            adminPasswordModal = document.getElementById('admin-password-modal');
            adminPasswordInput = document.getElementById('admin-password-input');
            adminPasswordSubmit = document.getElementById('admin-password-submit');
            adminPasswordClose = document.getElementById('admin-password-close');
            adminPasswordError = document.getElementById('admin-password-error');
            
            congratsModal = document.getElementById('congrats-modal');
            congratsModalClose = document.getElementById('congrats-modal-close');
            snowContainer = document.getElementById('snow-container');
            loadingOverlay = document.getElementById('loading-overlay');

            // --- í•„ìˆ˜ ìš”ì†Œ í™•ì¸ (í° í™”ë©´ ì˜¤ë¥˜ ë°©ì§€) ---
            if (!roomIdPage || !loginPage || !mainPage || !notesPage || !resultsPage || !adminPasswordModal || !congratsModal || !snowContainer || !loadingOverlay) {
                console.error("í•„ìˆ˜ DOM ìš”ì†Œ ì¤‘ ì¼ë¶€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML IDë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                document.body.innerHTML = '<h1 style="color: red; font-size: 24px; padding: 20px; text-align: center; background-color: white; color: black; height: 100vh; display: flex; align-items: center; justify-content: center;">ì˜¤ë¥˜: í˜ì´ì§€ì˜ ì¤‘ìš” ìš”ì†Œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. HTML IDê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</h1>';
                return;
            }
            
            // --- (ë°°í¬ìš©) Room ID í™•ì¸ ë° Firebase ì´ˆê¸°í™” ---
            currentRoomId = localStorage.getItem('roomId');
            if (currentRoomId) {
                showLoading("ì—°ê²° ì¤‘...");
                initializeAppAndAuth(currentRoomId);
            } else {
                showRoomIdPage();
            }

            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
            roomIdSubmit.addEventListener('click', handleRoomIdSubmit);
            roomIdInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleRoomIdSubmit();
            });

            loginButton.addEventListener('click', handleLogin);
            passInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            logoutButton.addEventListener('click', handleLogout);
            goToNotes.addEventListener('click', showNotesPage);
            goToMain.addEventListener('click', showMainPage);
            downloadNotesButton.addEventListener('click', () => handleDownloadNotes(currentStudentId, currentStudentName)); 
            
            calendarContainer.addEventListener('click', handleCalendarClick);
            
            modalSave.addEventListener('click', handleModalSave);
            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
            
            adminSettingsButton.addEventListener('click', openAdminPasswordModal);
            adminModalClose.addEventListener('click', closeAdminModal);
            adminModal.addEventListener('click', (e) => {
                if (e.target === adminModal) closeAdminModal();
            });
            downloadExampleExcel.addEventListener('click', downloadExampleExcelFile);
            uploadExcelButton.addEventListener('click', handleExcelUpload);
            viewResultsButton.addEventListener('click', showResultsPage);
            
            backToLoginButton.addEventListener('click', () => {
                if (adminSelectedUnsubscribe) adminSelectedUnsubscribe();
                if (studentListUnsubscribe) studentListUnsubscribe();
                showLoginPage();
            });
            studentListContainer.addEventListener('click', handleStudentResultClick);
            downloadAdminResultButton.addEventListener('click', handleAdminDownloadNotes);
            
            adminPasswordClose.addEventListener('click', closeAdminPasswordModal);
            adminPasswordModal.addEventListener('click', (e) => {
                if (e.target === adminPasswordModal) closeAdminPasswordModal();
            });
            adminPasswordSubmit.addEventListener('click', handleAdminPasswordSubmit);
            adminPasswordInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleAdminPasswordSubmit();
            });
            
            congratsModalClose.addEventListener('click', closeCongratsModal);
            congratsModal.addEventListener('click', (e) => {
                if (e.target === congratsModal) closeCongratsModal();
            });
        }
        
        // --- Firebase ë° Room ID ê´€ë ¨ í•¨ìˆ˜ ---

        function showLoading(message) {
            loadingOverlay.querySelector('p').textContent = message;
            loadingOverlay.classList.remove('hidden');
        }
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        // Room ID ì…ë ¥ í˜ì´ì§€ í‘œì‹œ
        function showRoomIdPage() {
            hideLoading();
            roomIdPage.classList.remove('hidden');
            loginPage.classList.add('hidden');
            mainPage.classList.add('hidden');
            notesPage.classList.add('hidden');
            resultsPage.classList.add('hidden');
        }
        
        // Room ID ì œì¶œ ì²˜ë¦¬
        function handleRoomIdSubmit() {
            const roomId = roomIdInput.value.trim().replace(/[\/.]/g, ''); // Firestore ê²½ë¡œì— ê¸ˆì§€ ë¬¸ì ì œê±°
            if (roomId.length < 3) {
                roomIdError.textContent = 'IDëŠ” 3ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                return;
            }
            roomIdError.textContent = '';
            roomIdLoading.classList.remove('hidden');
            roomIdSubmit.disabled = true;

            // ID ì €ì¥ ë° Firebase ì´ˆê¸°í™”
            localStorage.setItem('roomId', roomId);
            currentRoomId = roomId;
            initializeAppAndAuth(roomId);
        }

        // Firebase ì´ˆê¸°í™” (ë°°í¬ìš©)
        async function initializeAppAndAuth(roomId) {
            try {
                // (â˜…ë°°í¬ìš©â˜…) 2ë‹¨ê³„ì—ì„œ ë¶™ì—¬ë„£ì€ firebaseConfig ì‚¬ìš©
                if (!firebaseConfig.apiKey) {
                    throw new Error("Firebase: firebaseConfigê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (2ë‹¨ê³„ í™•ì¸)");
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug');

                // (â˜…ë°°í¬ìš©â˜…) ìµëª… ì¸ì¦ë§Œ ì‚¬ìš©
                await signInAnonymously(auth);
                
                onAuthStateChanged(auth, (user) => {
                    if (user) console.log("Firebase ìµëª… ì¸ì¦ ì„±ê³µ:", user.uid);
                });

                // í•™ìƒ DB ë¡œë“œ (Firebase)
                await loadStudentDB(); 

                const storedId = localStorage.getItem('currentStudentId');
                const storedName = localStorage.getItem('currentStudentName');

                hideLoading();

                if (storedId && storedName) {
                    currentStudentId = storedId;
                    currentStudentName = storedName;
                    showMainPage();
                } else {
                    showLoginPage();
                }

            } catch (err) {
                console.error("Firebase ì´ˆê¸°í™” ë˜ëŠ” ì¸ì¦ ì˜¤ë¥˜:", err);
                hideLoading();
                roomIdLoading.classList.add('hidden');
                roomIdSubmit.disabled = false;
                
                if (err.message.includes("auth/configuration-not-found")) {
                     roomIdError.textContent = `[ì˜¤ë¥˜] Firebase 'ìµëª… ë¡œê·¸ì¸'ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (3ë‹¨ê³„ í™•ì¸)`;
                } else {
                     roomIdError.textContent = `ì—°ê²° ì˜¤ë¥˜: ${err.message}. ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.`;
                }
                localStorage.removeItem('roomId');
            }
        }

        // --- í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ ---
        function showLoginPage() {
            hideLoading();
            roomIdPage.classList.add('hidden');
            loginPage.classList.remove('hidden'); 
            mainPage.classList.add('hidden');
            notesPage.classList.add('hidden');
            resultsPage.classList.add('hidden');
            closeAdminModal();
            closeAdminPasswordModal();
            if (userAnswersUnsubscribe) userAnswersUnsubscribe();
            if (studentListUnsubscribe) studentListUnsubscribe();
            if (adminSelectedUnsubscribe) adminSelectedUnsubscribe();
        }

        function showMainPage() {
            showLoading("ìº˜ë¦°ë” ë¡œë”© ì¤‘...");
            loginPage.classList.add('hidden');
            mainPage.classList.remove('hidden'); 
            notesPage.classList.add('hidden');
            resultsPage.classList.add('hidden');
            
            studentNameHeader.textContent = `${currentStudentName}ë‹˜ì˜ 2025ë…„ ìº˜ë¦°ë”`;
            
            attachUserAnswersListener();

            const treeImage = new Image();
            treeImage.onload = function() {
                hideLoading();
            };
            treeImage.onerror = function() {
                hideLoading();
                console.error("íŠ¸ë¦¬ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                calendarContainer.innerHTML = `<div class="absolute inset-0 flex items-center justify-center bg-red-900 text-white p-4 text-center rounded-lg">
                    <p class="text-xl"><i class="fas fa-exclamation-triangle mr-2"></i> ìº˜ë¦°ë” ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                </div>`;
            }
            treeImage.src = 'https://i.imgur.com/gf0wfmi.jpeg';
        }

        function showNotesPage() {
            loginPage.classList.add('hidden');
            mainPage.classList.add('hidden');
            notesPage.classList.remove('hidden');
            resultsPage.classList.add('hidden');
            
            notesHeader.textContent = `${currentStudentName}ë‹˜ì˜ 2025ë…„ ìª½ì§€í•¨`;
            renderNotes();
        }

        function showResultsPage() {
            loginPage.classList.add('hidden');
            mainPage.classList.add('hidden');
            notesPage.classList.add('hidden');
            resultsPage.classList.remove('hidden');
            
            closeAdminModal(); 
            
            renderStudentList();
            
            resultDetailName.textContent = "í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”";
            studentResultDetail.innerHTML = '<p class="text-xl text-center p-8">ì™¼ìª½ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ë©´<br>ì‘ì„±í•œ ìª½ì§€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
            downloadAdminResultButton.classList.add('hidden');
        }

        // --- ê´€ë¦¬ì ëª¨ë‹¬ ì œì–´ ---
        function openAdminPasswordModal() {
            adminPasswordModal.classList.remove('hidden');
            setTimeout(() => {
                adminPasswordModal.classList.remove('opacity-0');
                adminPasswordModal.querySelector('.modal-content').classList.remove('scale-95');
                adminPasswordInput.focus();
            }, 10);
        }
        function closeAdminPasswordModal() {
            adminPasswordModal.classList.add('opacity-0');
            adminPasswordModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                adminPasswordModal.classList.add('hidden');
                adminPasswordInput.value = '';
                adminPasswordError.textContent = '';
            }, 300);
        }
        function handleAdminPasswordSubmit() {
            if (adminPasswordInput.value === ADMIN_PASS) {
                closeAdminPasswordModal();
                openAdminModal();
            } else {
                adminPasswordError.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        }
        function openAdminModal() {
            adminModal.classList.remove('hidden');
            setTimeout(() => {
                adminModal.classList.remove('opacity-0');
                adminModal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }
        function closeAdminModal() {
            adminModal.classList.add('opacity-0');
            adminModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                adminModal.classList.add('hidden');
                adminMessage.textContent = '';
                excelFileInput.value = '';
            }, 300);
        }


        // --- (â˜…ë°°í¬ìš©â˜…) í•µì‹¬ ë¡œì§ í•¨ìˆ˜ (Firebase ì—°ë™) ---
        
        // 0. í•™ìƒ DB ë¡œë“œ (Firebase)
        async function loadStudentDB() {
            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/config
            const docRef = doc(db, currentRoomId, 'config');
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().list) {
                    studentDB = docSnap.data().list;
                    console.log("Firebaseì—ì„œ í•™ìƒ DBë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.");
                } else {
                    studentDB = [...defaultStudentDB];
                    console.log("Firebaseì— í•™ìƒ DBê°€ ì—†ì–´ ê¸°ë³¸ DBë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.");
                }
            } catch (err) {
                console.error("í•™ìƒ DB ë¡œë“œ ì˜¤ë¥˜:", err);
                studentDB = [...defaultStudentDB];
            }
        }
        
        // 1. ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin() {
            const name = nameInput.value.trim();
            const pass = passInput.value.trim();
            
            const user = studentDB.find(student => student.name === name && String(student.pass) === pass);

            if (user) {
                currentStudentId = user.id;
                currentStudentName = user.name;
                localStorage.setItem('currentStudentId', user.id);
                localStorage.setItem('currentStudentName', user.name);
                
                nameInput.value = '';
                passInput.value = '';
                loginError.textContent = '';
                
                showMainPage();
            } else {
                loginError.textContent = 'ì´ë¦„ì´ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”!';
                loadStudentDB();
            }
        }
        
        // 2. ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            localStorage.removeItem('currentStudentId');
            localStorage.removeItem('currentStudentName');
            localStorage.removeItem('roomId'); // (â˜…ì¶”ê°€â˜…) ë¡œê·¸ì•„ì›ƒ ì‹œ Room IDë„ ì´ˆê¸°í™”
            currentStudentId = null;
            currentStudentName = null;
            currentRoomId = null;
            userAnswers = {};
            showRoomIdPage(); // (â˜…ìˆ˜ì •â˜…) ë¡œê·¸ì¸ ëŒ€ì‹  Room ID í˜ì´ì§€ë¡œ
        }

        // 3. ìº˜ë¦°ë” í•«ìŠ¤íŒŸ ë Œë”ë§
        function renderCalendar() {
            calendarContainer.innerHTML = '';
            
            if (CURRENT_MONTH !== 12) {
                 // 12ì›”ì´ ì•„ë‹ ê²½ìš° í…ŒìŠ¤íŠ¸ ëª¨ë“œì„ì„ ì•Œë¦¼ (ì‹¤ì œ ì ê¸ˆì€ isLockedì—ì„œ ì²˜ë¦¬)
                 console.log(`[TEST MODE] í˜„ì¬ ë‚ ì§œë¥¼ ${CURRENT_MONTH}ì›” ${CURRENT_DAY}ì¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.`);
            }
            
            // (â˜…ìˆ˜ì •â˜…) 24ì¼ì—ëŠ” 25ì¼ê¹Œì§€ ì—´ë¦¬ë„ë¡ ì„¤ì • (unlockLimit)
            let unlockLimit = CURRENT_DAY;
            if (CURRENT_MONTH === 12 && CURRENT_DAY === 24) {
                unlockLimit = 25;
            }

            for (let i = 1; i <= 25; i++) {
                const day = i;
                const answer = userAnswers[`day_${day}`]; 
                
                // (â˜…ìˆ˜ì •â˜…) unlockLimit ì‚¬ìš©
                const isLocked = (CURRENT_MONTH !== 12 || day > unlockLimit); 
                const isAnswered = answer !== null && answer !== undefined && answer.trim() !== '';
                const isUnlocked = !isLocked && !isAnswered;
                
                const daySpot = document.createElement('div');
                daySpot.classList.add('day-hotspot'); 
                daySpot.classList.add('absolute', 'transition-all', 'duration-300', 'transform');
                
                if (day === 25) {
                    daySpot.classList.add('day-star'); 
                } else {
                    daySpot.classList.add('rounded-full'); 
                }

                if (isLocked) {
                    daySpot.classList.add('day-locked', 'bg-gray-800', 'bg-opacity-60', 'cursor-not-allowed');
                } else if (isAnswered) {
                    daySpot.classList.add('day-answered', 'bg-yellow-300', 'bg-opacity-50', 'cursor-pointer');
                } else {
                    daySpot.classList.add('day-unlocked', 'cursor-pointer');
                    if (day === 25) {
                        daySpot.classList.add('bg-white', 'bg-opacity-50', 'hover:bg-white', 'hover:bg-opacity-75');
                    } else {
                        daySpot.classList.add('bg-white', 'bg-opacity-40', 'hover:bg-white', 'hover:bg-opacity-60');
                    }
                }

                const coords = hotspotCoordinates[day - 1];
                if (coords) {
                    daySpot.style.top = coords.top;
                    daySpot.style.left = coords.left;
                    daySpot.style.width = coords.size;
                    daySpot.style.height = coords.size;
                } else {
                    console.warn(`Day ${day}ì˜ ì¢Œí‘œê°€ ì—†ìŠµë‹ˆë‹¤.`);
                    continue; 
                }

                if (!isLocked) {
                    daySpot.dataset.day = day; 
                }
                
                calendarContainer.appendChild(daySpot);
            }
        }

        // 4. ìº˜ë¦°ë” í´ë¦­ ì²˜ë¦¬
        function handleCalendarClick(e) {
            const daySpot = e.target.closest('.day-hotspot'); 
            if (daySpot && !daySpot.classList.contains('day-locked')) {
                const day = daySpot.dataset.day;
                if (day) {
                    openModal(day); 
                }
            }
        }

        // 5. ëª¨ë‹¬(íŒì—…) ì—´ê¸°
        function openModal(day) {
            const questionIndex = day - 1; 
            if (questionIndex < 0 || questionIndex >= questionsDB.length) return; 
            
            const question = questionsDB[questionIndex];
            const savedAnswer = userAnswers[`day_${day}`];
            
            modal.dataset.day = day; 
            modalTitle.textContent = `12ì›” ${day}ì¼ì˜ ì§ˆë¬¸`;
            modalQuestion.textContent = `Q. ${question}`;
            modalTextarea.value = savedAnswer || '';
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        // 6. ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // 7. ë‹µë³€ ì €ì¥ ì²˜ë¦¬
        async function handleModalSave() {
            const day = modal.dataset.day;
            const answer = modalTextarea.value.trim();
            
            const wasCompleted = checkCompletion();
            
            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/{studentId}
            const docRef = doc(db, currentRoomId, currentStudentId);
            
            try {
                await setDoc(docRef, {
                    [`day_${day}`]: answer
                }, { merge: true });

                closeModal();

                userAnswers[`day_${day}`] = answer;
                const isCompleted = checkCompletion();
                if (isCompleted && !wasCompleted) {
                    showSnow();
                    showCongratsModal();
                }

            } catch (err) {
                console.error("ë‹µë³€ ì €ì¥ ì˜¤ë¥˜:", err);
                alert("ë‹µë³€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        }

        // 8. ìª½ì§€ ëª¨ì•„ë³´ê¸° ë Œë”ë§
        function renderNotes() {
            notesContainer.innerHTML = '';
            let notesFound = false;

            for (let i = 1; i <= 25; i++) {
                const day = i;
                const answer = userAnswers[`day_${day}`];
                
                if (answer !== null && answer !== undefined && answer.trim() !== '') {
                    notesFound = true;
                    const questionIndex = day - 1;
                    if (questionIndex < 0 || questionIndex >= questionsDB.length) continue; 
                    
                    const question = questionsDB[questionIndex];
                    
                    const noteItem = document.createElement('div');
                    noteItem.className = "note-item bg-yellow-100 text-gray-900 p-4 rounded-md shadow-md mb-4";
                    
                    const h3 = document.createElement('h3');
                    h3.className = "text-2xl font-bold mb-2 text-green-800";
                    h3.textContent = `12ì›” ${day}ì¼`;
                    
                    const strong = document.createElement('strong');
                    strong.className = "text-xl text-gray-700";
                    strong.textContent = `Q. ${question}`;
                    
                    const p = document.createElement('p');
                    p.className = "text-xl mt-2 whitespace-pre-wrap";
                    p.textContent = `A: ${answer}`;
                    
                    noteItem.appendChild(h3);
                    noteItem.appendChild(strong);
                    noteItem.appendChild(p);
                    notesContainer.appendChild(noteItem);
                }
            }

            if (!notesFound) {
                notesContainer.innerHTML = '<p class="text-xl text-center p-8">ì•„ì§ ì‘ì„±ëœ ìª½ì§€ê°€ ì—†ì–´ìš”. ìº˜ë¦°ë”ì—ì„œ ì§ˆë¬¸ì— ë‹µí•´ë³´ì„¸ìš”!</p>';
            }
        }
        
        // 9. ëª¨ë“  ìª½ì§€ ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ
        function handleDownloadNotes(studentId, studentName) {
            const exportContainer = document.getElementById('export-container');
            if (!exportContainer) return;

            const button = downloadNotesButton;
            const originalButtonText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì €ì¥ ì¤‘...';
            button.disabled = true;

            exportContainer.innerHTML = ''; 
            
            const h1 = document.createElement('h1');
            h1.textContent = `${studentName}ë‹˜ì˜ 2025ë…„ 12ì›” ì´ì•¼ê¸°`;
            exportContainer.appendChild(h1);

            let notesFound = false;
            for (let i = 1; i <= 25; i++) {
                const day = i;
                // (â˜…ë°°í¬ìš©â˜…) í˜„ì¬ userAnswersì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const answer = userAnswers[`day_${day}`];
                
                if (answer !== null && answer !== undefined && answer.trim() !== '') {
                    notesFound = true;
                    const questionIndex = day - 1;
                    if (questionIndex < 0 || questionIndex >= questionsDB.length) continue; 
                    const question = questionsDB[questionIndex];
                    
                    const noteItem = document.createElement('div');
                    noteItem.className = "note-item"; 
                    const h3 = document.createElement('h3');
                    h3.textContent = `12ì›” ${day}ì¼`;
                    const strong = document.createElement('strong');
                    strong.textContent = `Q. ${question}`;
                    const p = document.createElement('p');
                    p.textContent = `A: ${answer}`;
                    noteItem.appendChild(h3);
                    noteItem.appendChild(strong);
                    noteItem.appendChild(p);
                    exportContainer.appendChild(noteItem);
                }
            }
            if (!notesFound) {
                 const p = document.createElement('p');
                 p.textContent = "ì•„ì§ ì‘ì„±ëœ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
                 exportContainer.appendChild(p);
            }
            setTimeout(() => {
                html2canvas(exportContainer, { scale: 2, useCORS: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = `${studentId}_advent_notes_2025.png`;
                    link.click();
                    button.innerHTML = originalButtonText;
                    button.disabled = false;
                    exportContainer.innerHTML = '';
                }).catch(err => {
                    console.error("ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:", err);
                    alert("ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    button.innerHTML = originalButtonText; 
                    button.disabled = false;
                    exportContainer.innerHTML = '';
                });
            }, 500); 
        }

        // 10. ì—‘ì…€ ì˜ˆì‹œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadExampleExcelFile(e) {
            e.preventDefault();
            const exampleData = [ { name: "í™ê¸¸ë™", pass: "1234" }, { name: "ì„±ì¶˜í–¥", pass: "5678" } ];
            const ws = XLSX.utils.json_to_sheet(exampleData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "í•™ìƒëª…ë‹¨");
            XLSX.writeFile(wb, "student_list_example.xlsx");
        }

        // 11. ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleReadError(err) {
            console.error("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:", err);
            adminMessage.textContent = 'íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            adminMessage.classList.add('text-red-500');
        }
        function handleUploadError(err) {
            console.error("ì—‘ì…€/CSV ì²˜ë¦¬ ì˜¤ë¥˜:", err);
            const defaultError = "íŒŒì¼ì— 'name'ê³¼ 'pass' ì»¬ëŸ¼ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.";
            adminMessage.textContent = `ì˜¤ë¥˜: ${err.message.includes('ì»¬ëŸ¼') || err.message.includes('ë°ì´í„°') ? err.message : defaultError}`;
            adminMessage.classList.add('text-red-500');
        }

        async function processWorkbook(workbook) {
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            let newStudentList = XLSX.utils.sheet_to_json(worksheet, { raw: false, defval: "" });
            
            if (newStudentList.length > 0) {
                const firstStudent = newStudentList[0];
                if (firstStudent.hasOwnProperty('name') && firstStudent.hasOwnProperty('pass')) {
                    
                    const processedStudentList = newStudentList.map((student, index) => {
                        return {
                            id: `student_${index + 1}_${Date.now()}`,
                            name: String(student.name || "").trim(),
                            pass: String(student.pass || "").trim()
                        };
                    });

                    // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/config
                    const docRef = doc(db, currentRoomId, 'config');
                    try {
                        await setDoc(docRef, { list: processedStudentList });
                        
                        adminMessage.textContent = `ì„±ê³µ! ${processedStudentList.length}ëª…ì˜ í•™ìƒ ëª…ë‹¨ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                        adminMessage.classList.add('text-green-500');
                        setTimeout(closeAdminModal, 2000);

                    } catch (err) {
                        console.error("Firebase í•™ìƒ ëª…ë‹¨ ì €ì¥ ì˜¤ë¥˜:", err);
                        throw new Error("DB ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                    
                } else {
                    throw new Error("íŒŒì¼ì— 'name'ê³¼ 'pass' ì»¬ëŸ¼ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.");
                }
            } else {
                throw new Error("ì—‘ì…€/CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function handleExcelUpload() {
            const file = excelFileInput.files[0];
            if (!file) {
                adminMessage.textContent = 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                adminMessage.classList.add('text-red-500');
                return;
            }
            adminMessage.textContent = 'ì²˜ë¦¬ ì¤‘...';
            adminMessage.classList.remove('text-red-500', 'text-green-500');

            const reader = new FileReader();

            if (file.name.endsWith('.xlsx')) {
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        processWorkbook(workbook);
                    } catch (err) {
                        handleUploadError(err);
                    }
                };
                reader.onerror = handleReadError;
                reader.readAsArrayBuffer(file);

            } else if (file.name.endsWith('.csv')) {
                reader.onload = function(e) {
                    try {
                        let data = e.target.result;
                        if (data.startsWith('\uFEFF')) data = data.substring(1);
                        const workbook = XLSX.read(data, { type: 'string' });
                        processWorkbook(workbook);
                    } catch (err) {
                        handleUploadError(err);
                    }
                };
                reader.onerror = handleReadError;
                reader.readAsText(file);
            } else {
                adminMessage.textContent = 'ì˜¤ë¥˜: .xlsx ë˜ëŠ” .csv íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤.';
                adminMessage.classList.add('text-red-500');
            }
        }

        // 12. ê´€ë¦¬ì - í•™ìƒ ëª©ë¡ ë Œë”ë§
        function renderStudentList() {
            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/config
            const docRef = doc(db, currentRoomId, 'config');
            
            if (studentListUnsubscribe) studentListUnsubscribe();

            studentListContainer.innerHTML = '<p>í•™ìƒ ëª©ë¡ ë¡œë”© ì¤‘...</p>';
            
            studentListUnsubscribe = onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists() && docSnap.data().list && docSnap.data().list.length > 0) {
                    studentDB = docSnap.data().list;
                    studentListContainer.innerHTML = '';
                    
                    studentDB.forEach(student => {
                        const button = document.createElement('button');
                        button.className = "student-list-button w-full text-left p-3 rounded-lg bg-green-800 hover:bg-green-700 transition-colors text-white text-xl";
                        button.textContent = student.name;
                        button.dataset.id = student.id;
                        button.dataset.name = student.name;
                        studentListContainer.appendChild(button);
                    });
                } else {
                    studentDB = [...defaultStudentDB];
                    studentListContainer.innerHTML = '<p>ë“±ë¡ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤. (ê¸°ë³¸ê°’ í‘œì‹œ)</p>';
                }
            }, (err) => {
                console.error("í•™ìƒ ëª©ë¡ ì‹¤ì‹œê°„ ë¡œë“œ ì˜¤ë¥˜:", err);
                studentListContainer.innerHTML = '<p class="text-red-400">í•™ìƒ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</p>';
            });
        }

        // 13. ê´€ë¦¬ì - í•™ìƒ ëª©ë¡ í´ë¦­ ì²˜ë¦¬
        function handleStudentResultClick(e) {
            const button = e.target.closest('.student-list-button');
            if (!button) return;

            const studentId = button.dataset.id;
            const studentName = button.dataset.name;

            studentListContainer.querySelectorAll('.student-list-button').forEach(btn => {
                btn.classList.remove('bg-yellow-400', 'text-green-900', 'font-bold');
                btn.classList.add('bg-green-800', 'text-white');
            });
            button.classList.add('bg-yellow-400', 'text-green-900', 'font-bold');
            button.classList.remove('bg-green-800', 'text-white');

            renderStudentResultDetail(studentId, studentName);
        }

        // 14. ê´€ë¦¬ì - ì„ íƒëœ í•™ìƒì˜ ê²°ê³¼ ë Œë”ë§
        function renderStudentResultDetail(studentId, studentName) {
            resultDetailName.textContent = `${studentName}ë‹˜ì˜ ë‹µë³€`;
            studentResultDetail.innerHTML = '<p>ë‹µë³€ ë¡œë”© ì¤‘...</p>';
            
            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/{studentId}
            const docRef = doc(db, currentRoomId, studentId);
            
            if (adminSelectedUnsubscribe) adminSelectedUnsubscribe();

            adminSelectedUnsubscribe = onSnapshot(docRef, (docSnap) => {
                adminSelectedAnswers = docSnap.exists() ? docSnap.data() : {};
                studentResultDetail.innerHTML = '';
                let notesFound = false;
                
                downloadAdminResultButton.dataset.id = studentId;
                downloadAdminResultButton.dataset.name = studentName;
                downloadAdminResultButton.classList.remove('hidden');

                for (let i = 1; i <= 25; i++) {
                    const day = i;
                    const answer = adminSelectedAnswers[`day_${day}`];
                    
                    if (answer !== null && answer !== undefined && answer.trim() !== '') {
                        notesFound = true;
                        const questionIndex = day - 1;
                        if (questionIndex < 0 || questionIndex >= questionsDB.length) continue; 
                        
                        const question = questionsDB[questionIndex];
                        
                        const noteItem = document.createElement('div');
                        noteItem.className = "note-item bg-yellow-100 text-gray-900 p-4 rounded-md shadow-md mb-4";
                        const h3 = document.createElement('h3');
                        h3.className = "text-2xl font-bold mb-2 text-green-800";
                        h3.textContent = `12ì›” ${day}ì¼`;
                        const strong = document.createElement('strong');
                        strong.className = "text-xl text-gray-700";
                        strong.textContent = `Q. ${question}`;
                        const p = document.createElement('p');
                        p.className = "text-xl mt-2 whitespace-pre-wrap";
                        p.textContent = `A: ${answer}`;
                        noteItem.appendChild(h3);
                        noteItem.appendChild(strong);
                        noteItem.appendChild(p);
                        studentResultDetail.appendChild(noteItem);
                    }
                }
                if (!notesFound) {
                    studentResultDetail.innerHTML = '<p class="text-xl text-center p-8">ì•„ì§ ì‘ì„±ëœ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            }, (err) => {
                console.error("ê´€ë¦¬ììš© í•™ìƒ ë‹µë³€ ë¡œë“œ ì˜¤ë¥˜:", err);
                studentResultDetail.innerHTML = '<p class="text-red-400">í•™ìƒ ë‹µë³€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</p>';
            });
        }
        
        // 15. ê´€ë¦¬ììš© ìª½ì§€ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        async function handleAdminDownloadNotes() {
            const studentId = downloadAdminResultButton.dataset.id;
            const studentName = downloadAdminResultButton.dataset.name;
            if (!studentId || !studentName) return;

            const exportContainer = document.getElementById('export-container');
            if (!exportContainer) return;
            
            const button = downloadAdminResultButton;
            const originalButtonText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì €ì¥ ì¤‘...';
            button.disabled = true;

            exportContainer.innerHTML = ''; 
            const h1 = document.createElement('h1');
            h1.textContent = `${studentName}ë‹˜ì˜ 2025ë…„ 12ì›” ì´ì•¼ê¸°`;
            exportContainer.appendChild(h1);

            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/{studentId}
            const docRef = doc(db, currentRoomId, studentId);
            let answersToExport = {};
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    answersToExport = docSnap.data();
                }
            } catch (err) {
                console.error("ì´ë¯¸ì§€ ì €ì¥ìš© ë‹µë³€ ë¡œë“œ ì˜¤ë¥˜:", err);
                alert("ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                button.innerHTML = originalButtonText;
                button.disabled = false;
                return;
            }

            let notesFound = false;
            for (let i = 1; i <= 25; i++) {
                const day = i;
                const answer = answersToExport[`day_${day}`];
                
                if (answer !== null && answer !== undefined && answer.trim() !== '') {
                    notesFound = true;
                    const questionIndex = day - 1;
                    if (questionIndex < 0 || questionIndex >= questionsDB.length) continue; 
                    const question = questionsDB[questionIndex];
                    
                    const noteItem = document.createElement('div');
                    noteItem.className = "note-item"; 
                    const h3 = document.createElement('h3');
                    h3.textContent = `12ì›” ${day}ì¼`;
                    const strong = document.createElement('strong');
                    strong.textContent = `Q. ${question}`;
                    const p = document.createElement('p');
                    p.textContent = `A: ${answer}`;
                    noteItem.appendChild(h3);
                    noteItem.appendChild(strong);
                    noteItem.appendChild(p);
                    exportContainer.appendChild(noteItem);
                }
            }
            if (!notesFound) {
                 const p = document.createElement('p');
                 p.textContent = "ì•„ì§ ì‘ì„±ëœ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
                 exportContainer.appendChild(p);
            }

            setTimeout(() => {
                html2canvas(exportContainer, { scale: 2, useCORS: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = `${studentId}_advent_notes_2025.png`;
                    link.click();
                    button.innerHTML = originalButtonText;
                    button.disabled = false;
                    exportContainer.innerHTML = '';
                }).catch(err => {
                    console.error("ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:", err);
                    alert("ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    button.innerHTML = originalButtonText; 
                    button.disabled = false;
                    exportContainer.innerHTML = '';
                });
            }, 500); 
        }

        // 16. í•™ìƒ ë‹µë³€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
        function attachUserAnswersListener() {
            // (â˜…ë°°í¬ìš©â˜…) DB ê²½ë¡œ: /{currentRoomId}/{studentId}
            const docRef = doc(db, currentRoomId, currentStudentId);
            
            if (userAnswersUnsubscribe) userAnswersUnsubscribe();

            userAnswersUnsubscribe = onSnapshot(docRef, (docSnap) => {
                userAnswers = docSnap.exists() ? docSnap.data() : {};
                console.log("ì‹¤ì‹œê°„ ë‹µë³€ ì—…ë°ì´íŠ¸:", userAnswers);

                renderCalendar(); 
                if (checkCompletion()) {
                    showSnow();
                }
            }, (err) => {
                console.error("í•™ìƒ ë‹µë³€ ì‹¤ì‹œê°„ ë¡œë“œ ì˜¤ë¥˜:", err);
                alert("ë‹µë³€ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            });
        }

        // 17. 25ì¼ ì™„ì„± ì—¬ë¶€ í™•ì¸
        function checkCompletion() {
            for (let i = 1; i <= 25; i++) {
                const answer = userAnswers[`day_${i}`];
                if (!answer || answer.trim() === '') {
                    return false;
                }
            }
            return true;
        }

        // 18. ëˆˆì†¡ì´ ìƒì„±
        function createSnowflakes() {
            if (snowCreated) return;
            const snowAmount = 100;
            snowContainer.innerHTML = '';
            const styleSheet = document.createElement("style");
            document.head.appendChild(styleSheet);
            
            for (let i = 0; i < snowAmount; i++) {
                const snowflake = document.createElement('div');
                const size = Math.random() * 5 + 2;
                const duration = Math.random() * 5 + 10;
                const delay = Math.random() * 10;
                const startX = Math.random() * 100;
                const wind = (Math.random() - 0.5) * 200;

                snowflake.classList.add('snowflake');
                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                snowflake.style.left = `${startX}vw`;
                snowflake.style.animationDuration = `${duration}s`;
                snowflake.style.animationDelay = `${delay}s`;
                
                const keyframeName = `fall-${i}`;
                snowflake.style.animationName = keyframeName;
                
                styleSheet.sheet.insertRule(`
                    @keyframes ${keyframeName} {
                        0% { transform: translateY(-10px) translateX(0px); opacity: 0.8; }
                        100% { transform: translateY(105vh) translateX(${wind}px); opacity: 0; }
                    }
                `, styleSheet.sheet.cssRules.length);

                snowContainer.appendChild(snowflake);
            }
            snowCreated = true;
        }

        // 19. ëˆˆ ë‚´ë¦¬ê¸° íš¨ê³¼ í‘œì‹œ
        function showSnow() {
            createSnowflakes();
            snowContainer.classList.remove('hidden');
        }

        // 20. ì¶•í•˜ ëª¨ë‹¬ ì—´ê¸°
        function showCongratsModal() {
            congratsModal.classList.remove('hidden');
            setTimeout(() => {
                congratsModal.classList.remove('opacity-0');
                congratsModal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        // 21. ì¶•í•˜ ëª¨ë‹¬ ë‹«ê¸°
        function closeCongratsModal() {
            congratsModal.classList.add('opacity-0');
            congratsModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                congratsModal.classList.add('hidden');
            }, 300);
        }

    </script>
    
    <style>
        body, html {
            font-family: 'Gaegu', cursive;
            background-color: #052e16; /* ì§™ì€ ë…¹ìƒ‰ (ë°°ê²½) */
            color: #fefce8; /* ë”°ëœ»í•œ í°ìƒ‰ (ì•„ì´ë³´ë¦¬) */
        }
        
        #calendar-image-container {
            background-image: url('https://i.imgur.com/gf0wfmi.jpeg'); 
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center; 
            background-color: #044722;
            aspect-ratio: 100 / 109; 
        }

        .day-hotspot {
            z-index: 10;
        }

        .day-hotspot.day-unlocked {
            border: 2px dashed rgba(255, 255, 255, 0.6);
        }
        
        .day-hotspot.day-star.day-unlocked {
             border: 3px dashed rgba(255, 255, 100, 0.8);
        }

        .day-hotspot.day-answered {
            border: 2px solid rgba(253, 224, 71, 0.8);
            box-shadow: 0 0 15px 5px rgba(253, 224, 71, 0.6),
                        inset 0 0 5px 2px rgba(255, 255, 255, 0.7);
        }
        
        .day-star {
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .day-star.day-answered {
             box-shadow: 0 0 20px 8px rgba(253, 224, 71, 0.7),
                inset 0 0 8px 3px rgba(255, 255, 255, 0.8);
        }

        .note-item {
            border: 1px solid #facc15;
            white-space: pre-wrap;
        }
        
        /* ëˆˆ ë‚´ë¦¬ê¸° íš¨ê³¼ */
        #snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
        
        /* ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°ìš© (ìˆ¨ê¹€) */
        #export-container {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 800px; /* A4 ìš©ì§€ ë¹„ìœ¨ì— ë§ì¶˜ ë„ˆë¹„ */
            padding: 40px;
            background-color: #fefce8; /* ìª½ì§€ì™€ ìœ ì‚¬í•œ ë°°ê²½ìƒ‰ */
            color: #1f2937; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            font-family: 'Gaegu', cursive;
        }
        #export-container h1 {
            font-size: 2.5rem; /* 40px */
            font-weight: 700;
            margin-bottom: 2rem; /* 32px */
            text-align: center;
            color: #052e16; /* ì§™ì€ ë…¹ìƒ‰ */
        }
        #export-container .note-item {
            background-color: #fef3c7; /* yellow-100 */
            color: #374151; /* gray-700 */
            padding: 1.5rem; /* 24px */
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem; /* 24px */
            border: 1px solid #facc15;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
        }
        #export-container .note-item h3 {
            font-size: 1.875rem; /* 30px */
            font-weight: 700;
            margin-bottom: 0.5rem; /* 8px */
            color: #065f46; /* green-800 */
        }
        #export-container .note-item strong {
            font-size: 1.5rem; /* 24px */
            color: #374151; /* gray-700 */
            display: block;
        }
        #export-container .note-item p {
            font-size: 1.5rem; /* 24px */
            margin-top: 0.75rem; /* 12px */
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
        }

    </style>
</head>
<body id="main-body" class="bg-green-900">

    <!-- 0. ëˆˆ ë‚´ë¦¬ê¸° ì»¨í…Œì´ë„ˆ -->
    <div id="snow-container" class="hidden"></div>

    <div id="app" class="w-full max-w-4xl mx-auto">

        <!-- 0. ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-center z-[9999]">
            <i class="fas fa-spinner fa-spin text-6xl text-white mb-4"></i>
            <p class="text-2xl text-white">ì—°ê²° ì¤‘...</p>
        </div>

        <!-- 0. (â˜…ë°°í¬ìš©â˜…) í•™ê¸‰ ID ì…ë ¥ í˜ì´ì§€ -->
        <div id="room-id-page" class="min-h-screen flex flex-col items-center justify-center p-4 hidden">
            <div class="text-center p-8 bg-green-900 bg-opacity-75 rounded-lg shadow-xl w-full max-w-lg">
                <h1 class="text-5xl font-bold mb-4">í™˜ì˜í•©ë‹ˆë‹¤!</h1>
                <p class="text-xl mb-6">ìš°ë¦¬ í•™ê¸‰(í•™êµ)ë§Œì˜<br><strong class="text-yellow-300 text-2xl">ê³ ìœ  ID</strong>ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <p class="text-lg mb-6 text-gray-300">(ì„ ìƒë‹˜ì´ ì•Œë ¤ì¤€ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br>ì˜ˆ: `ã…‡ã…‡ì´ˆ 5-1, ã…‡ã…‡ì´ˆ ë³„ë¹›ë°˜`)</p>
                
                <div class="space-y-4 max-w-sm mx-auto">
                    <input id="room-id-input" type="text" placeholder="í•™ê¸‰ ê³ ìœ  ID" class="w-full px-4 py-3 rounded-lg text-gray-900 text-2xl">
                    <button id="room-id-submit" class="w-full bg-yellow-400 hover:bg-yellow-300 text-green-900 text-3xl font-bold py-3 rounded-lg transition-colors">
                        <i class="fas fa-check"></i> í™•ì¸
                    </button>
                    <div id="room-id-loading" class="hidden text-center p-4">
                        <i class="fas fa-spinner fa-spin text-4xl text-white"></i>
                        <p class="text-xl mt-2">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...</p>
                    </div>
                    <p id="room-id-error" class="text-red-400 text-lg h-12"></p>
                </div>
            </div>
        </div>

        <!-- 1. ë¡œê·¸ì¸ í˜ì´ì§€ (login-page) -->
        <div id="login-page" class="min-h-screen flex flex-col items-center justify-center p-4 hidden">
            <div class="text-center p-8 bg-green-900 bg-opacity-75 rounded-lg shadow-xl w-full max-w-lg">
                <h1 class="text-5xl font-bold mb-4">2025ë…„ì„ ëŒì•„ë³´ëŠ”</h1>
                <h2 class="text-6xl font-bold mb-8 text-yellow-300">12ì›”ì˜ ì´ì•¼ê¸°</h2>
                <p class="text-xl mb-6">ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³ ,<br>ë‚˜ë§Œì˜ ë¹„ë°€ ìº˜ë¦°ë”ë¥¼ ì—´ì–´ë³´ì„¸ìš”.</p>
            
                <div class="space-y-4 max-w-sm mx-auto">
                    <input id="name-input" type="text" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)" class="w-full px-4 py-3 rounded-lg text-gray-900 text-2xl">
                    <input id="pass-input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ì˜ˆ: 1234)" class="w-full px-4 py-3 rounded-lg text-gray-900 text-2xl">
                    <button id="login-button" class="w-full bg-yellow-400 hover:bg-yellow-300 text-green-900 text-3xl font-bold py-3 rounded-lg transition-colors">
                        <i class="fas fa-gift"></i> ìº˜ë¦°ë” ì—´ê¸°
                    </button>
                    <p id="login-error" class="text-red-400 text-lg h-6"></p>
                </div>
            </div>
            
            <button id="admin-settings-button" class="absolute bottom-6 right-6 bg-gray-700 hover:bg-gray-600 text-white text-lg font-bold py-3 px-5 rounded-full shadow-lg">
                <i class="fas fa-cog"></i> ê´€ë¦¬ì ì„¤ì •
            </button>
        </div>

        <!-- 2. ë©”ì¸ ìº˜ë¦°ë” í˜ì´ì§€ (main-page) -->
        <div id="main-page" class="hidden p-4">
            <div class="flex justify-between items-center mb-6 flex-wrap">
                <h2 id="student-name-header" class="text-3xl sm:text-4xl font-bold">OOOë‹˜ì˜ 2025ë…„ ìº˜ë¦°ë”</h2>
                <div class="mt-4 sm:mt-0">
                    <button id="go-to-notes" class="bg-yellow-400 hover:bg-yellow-300 text-green-900 text-lg font-bold py-2 px-4 rounded-lg mr-2">
                        <i class="fas fa-book-open"></i> ë‚´ ìª½ì§€ ëª¨ì•„ë³´ê¸°
                    </button>
                    <button id="logout-button" class="bg-red-600 hover:bg-red-500 text-white text-lg font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            
            <div id="calendar-image-container" class="relative w-full max-w-2xl mx-auto">
                <!-- í•«ìŠ¤íŒŸ(ì „êµ¬)ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <p class="text-center text-sm mt-4 text-gray-400">
                 * ì´ ìº˜ë¦°ë”ì˜ ëª¨ë“  ê¸°ë¡ì€ í´ë¼ìš°ë“œì— ì‹¤ì‹œê°„ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
            </p>
        </div>

        <!-- 3. ìª½ì§€ ëª¨ì•„ë³´ê¸° (notes-page) -->
        <div id="notes-page" class="hidden p-4">
            <div class="flex justify-between items-center mb-6 flex-wrap">
                <h2 id="notes-header" class="text-3xl sm:text-4xl font-bold">OOOë‹˜ì˜ 2025ë…„ ìª½ì§€í•¨</h2>
                <div class="mt-4 sm:mt-0">
                     <button id="download-notes-button" class="bg-blue-600 hover:bg-blue-500 text-white text-lg font-bold py-2 px-4 rounded-lg mr-2">
                        <i class="fas fa-camera"></i> ìª½ì§€ ì‚¬ì§„ ì €ì¥
                    </button>
                    <button id="go-to-main" class="bg-yellow-400 hover:bg-yellow-300 text-green-900 text-lg font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-calendar-alt"></i> ìº˜ë¦°ë”ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            </div>
            
            <div id="notes-container" class="space-y-4 max-h-[70vh] overflow-y-auto bg-green-950 bg-opacity-50 p-4 rounded-lg">
                <!-- ìª½ì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- 4. ê´€ë¦¬ì - í•™ìƒ ê²°ê³¼ ë³´ê¸° (results-page) -->
        <div id="results-page" class="hidden p-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl sm:text-4xl font-bold">ê´€ë¦¬ì: í•™ìƒ ê²°ê³¼ ë³´ê¸°</h2>
                <button id="back-to-login-button" class="bg-yellow-400 hover:bg-yellow-300 text-green-900 text-lg font-bold py-2 px-4 rounded-lg">
                    <i class="fas fa-arrow-left"></i> ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ
                </button>
            </div>
            
            <div class="flex flex-col md:flex-row gap-6">
                <!-- ì™¼ìª½: í•™ìƒ ëª©ë¡ -->
                <div class="md:w-1/3 bg-green-950 bg-opacity-50 p-4 rounded-lg max-h-[70vh] overflow-y-auto">
                    <h3 class="text-2xl font-bold mb-4 border-b pb-2 border-gray-500">í•™ìƒ ëª©ë¡</h3>
                    <div id="student-list-container" class="space-y-2">
                        <!-- í•™ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <!-- ì˜¤ë¥¸ìª½: ì„ íƒëœ í•™ìƒì˜ ë‹µë³€ -->
                <div class="md:w-2/3 bg-green-950 bg-opacity-50 p-4 rounded-lg max-h-[70vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4 border-b pb-2 border-gray-500">
                         <h3 id="result-detail-name" class="text-2xl font-bold">í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</h3>
                         <button id="download-admin-result-button" class="hidden bg-blue-600 hover:bg-blue-500 text-white text-lg font-bold py-2 px-4 rounded-lg">
                            <i class="fas fa-camera"></i> ì´ í•™ìƒ ìª½ì§€ ì €ì¥
                        </button>
                    </div>
                    <div id="student-result-detail" class="space-y-4">
                        <!-- ì„ íƒëœ í•™ìƒì˜ ìª½ì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- 5. ì§ˆë¬¸ & ë‹µë³€ íŒì—… (Modal) -->
    <div id="modal" class="modal-overlay hidden opacity-0 fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center transition-opacity duration-300 z-50">
        <div class="modal-content transform scale-95 transition-transform duration-300 bg-white text-gray-900 p-6 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-3xl font-bold">12ì›” Xì¼ì˜ ì§ˆë¬¸</h3>
                <button id="modal-close" class="text-3xl text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            
            <p id="modal-question" class="text-2xl mb-4">Q. [ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤]</p>
            
            <textarea id="modal-textarea" rows="6" class="w-full p-3 border border-gray-300 rounded-lg text-xl text-gray-900" placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            
            <button id="modal-save" class="w-full mt-4 bg-green-700 hover:bg-green-600 text-white text-2xl font-bold py-3 rounded-lg transition-colors">
                <i class="fas fa-save"></i> ìª½ì§€ ì €ì¥í•˜ê¸°
            </button>
        </div>
    </div>
    
    <!-- 6. ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ (Admin Modal) -->
    <div id="admin-modal" class="modal-overlay hidden opacity-0 fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center transition-opacity duration-300 z-50">
        <div class="modal-content transform scale-95 transition-transform duration-300 bg-white text-gray-900 p-6 rounded-lg shadow-xl max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-3xl font-bold">ê´€ë¦¬ì ì„¤ì •</h3>
                <button id="admin-modal-close" class="text-3xl text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            
            <div class="space-y-6">
                <!-- ì—‘ì…€ ë“±ë¡ -->
                <div class="p-4 border rounded-lg bg-gray-50">
                    <h4 class="text-2xl font-bold mb-3 text-gray-800">1. í•™ìƒ ëª…ë‹¨ ê°±ì‹ í•˜ê¸°</h4>
                    <p class="text-lg mb-2">.xlsx ë˜ëŠ” .csv íŒŒì¼ë¡œ í•™ìƒ ëª…ë‹¨ì„ ë“±ë¡í•˜ì„¸ìš”.</p>
                    <p class="text-md mb-3 text-gray-600">íŒŒì¼ì€ 'name', 'pass' 2ê°œì˜ ì»¬ëŸ¼ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ('id'ëŠ” ìë™ ìƒì„±ë©ë‹ˆë‹¤)</p>
                    <a id="download-example-excel" href="#" class="text-lg text-blue-600 hover:underline mb-4 inline-block">[ ì—‘ì…€ ì˜ˆì‹œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ]</a>
                    <input id="excel-file-input" type="file" accept=".xlsx, .csv" class="w-full text-lg border p-2 rounded-lg">
                    <button id="upload-excel-button" class="w-full mt-3 bg-blue-600 hover:bg-blue-500 text-white text-2xl font-bold py-3 rounded-lg transition-colors">
                        <i class="fas fa-upload"></i> ëª…ë‹¨ ê°±ì‹ í•˜ê¸°
                    </button>
                    <p id="admin-message" class="text-lg h-6 mt-2"></p>
                </div>
                
                <!-- ê²°ê³¼ ë³´ê¸° -->
                <div class="p-4 border rounded-lg bg-gray-50">
                     <h4 class="text-2xl font-bold mb-3 text-gray-800">2. í•™ìƒ ê²°ê³¼ ë³´ê¸°</h4>
                     <p class="text-lg mb-3 text-gray-600">ë“±ë¡ëœ ëª¨ë“  í•™ìƒë“¤ì˜ ë‹µë³€ ë‚´ìš©ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
                     <button id="view-results-button" class="w-full bg-green-700 hover:bg-green-600 text-white text-2xl font-bold py-3 rounded-lg transition-colors">
                        <i class="fas fa-chart-bar"></i> í•™ìƒ ê²°ê³¼ ë³´ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 7. ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ (Admin Password Modal) -->
    <div id="admin-password-modal" class="modal-overlay hidden opacity-0 fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center transition-opacity duration-300 z-50">
        <div class="modal-content transform scale-95 transition-transform duration-300 bg-white text-gray-900 p-6 rounded-lg shadow-xl max-w-sm w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-3xl font-bold">ê´€ë¦¬ì ì ‘ê·¼</h3>
                <button id="admin-password-close" class="text-3xl text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <p class="text-xl mb-4">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input id="admin-password-input" type="password" class="w-full px-4 py-3 rounded-lg text-gray-900 text-2xl border border-gray-300">
            <p id="admin-password-error" class="text-red-500 text-lg h-6 mt-2"></p>
            <button id="admin-password-submit" class="w-full mt-4 bg-green-700 hover:bg-green-600 text-white text-2xl font-bold py-3 rounded-lg transition-colors">
                <i class="fas fa-key"></i> í™•ì¸
            </button>
        </div>
    </div>

    <!-- 8. 25ì¼ ì™„ì„± ì¶•í•˜ ëª¨ë‹¬ (Congrats Modal) -->
    <div id="congrats-modal" class="modal-overlay hidden opacity-0 fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center transition-opacity duration-300 z-50">
        <div class="modal-content transform scale-95 transition-transform duration-300 bg-gradient-to-br from-red-600 to-red-800 text-white p-8 rounded-lg shadow-xl max-w-md w-full text-center">
            <h2 class="text-7xl font-bold mb-4" style="font-family: 'Gaegu', cursive; text-shadow: 2px 2px #000;">Merry Christmas!</h2>
            <!-- (â˜…ê³ ì •â˜…) ì‚¬ìš©ìë‹˜ì´ ê³ ì •í•˜ì‹  ë¬¸êµ¬ì…ë‹ˆë‹¤. -->
            <p class="text-3xl mb-6">25ì¼ê°„ì˜ ëª¨ë“  ì´ì•¼ê¸°ë¥¼ ì™„ì„±í–ˆì–´ìš”!<br>2025ë…„, ì¦ê±°ì› ë‚˜ìš”? ğŸ„</p>
            <button id="congrats-modal-close" class="mt-4 bg-yellow-400 hover:bg-yellow-300 text-green-900 text-2xl font-bold py-3 px-6 rounded-lg transition-colors">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <!-- 9. ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°ìš© ìˆ¨ê²¨ì§„ DIV -->
    <div id="export-container" aria-hidden="true"></div>

</body>
</html>